{% block content %}
    <thead>
        <tr>
            <th width="40">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="selectAll">
                </div>
            </th>
            <th>User</th>
            <th>Email</th>
            <th>Role</th>
            <th>Status</th>
            <th>Last Active</th>
            <th>Actions</th>
            <th class="d-none">hidden_role</th>
            <th class="d-none">hidden_status</th>
        </tr>
    </thead>
    <tbody>
      {% for user in users %}
        <tr data-user-id="{{ user['id'] }}" data-status="{{ 'active' if user['is_active'] else 'inactive' }}" data-role="{{ user['role']|lower }}">
          <td>
            <div class="form-check">
              <input class="form-check-input user-checkbox" type="checkbox" value="{{ user['id'] }}">
            </div>
          </td>
          <td>
            <div class="d-flex align-items-center">
              {% if user['image'] %}
                <img src="{{ user['image'] }}" class="rounded-circle me-2" width="32" height="32" alt="{{ user['first_name'] }} {{ user['last_name'] }}">
              {% else %}
                <img src="{{ url_for('static', filename='img/avatars/user.png') }}" class="rounded-circle me-2" width="32" height="32" alt="Default Avatar">
              {% endif %}
              <div>
                <div class="fw-bold">{{ user['first_name']|title }} {{ user['last_name']|title }}</div>
                <small class="text-muted">{{ user['id'][:15] }}...</small>
              </div>
            </div>
          </td>
          <td>{{ user['email'] }}</td>
          <td>
            {% set role_colors = {
              'admin': 'primary',
              'psychologist': 'success',
              'staff': 'info',
              'client': 'secondary'
            } %}
            <span class="badge bg-{{ role_colors.get(user['role']|lower, 'dark') }}">
              {{ user['role']|title }}
            </span>
          </td>
          <td>
            <span class="badge bg-{{ 'success' if user['is_active'] else 'secondary' }}">
              {{ 'Active' if user['is_active'] else 'Inactive' }}
            </span>
          </td>
          <td>{{ user['last_login_at']|parse_iso_datetime|datetimeformat('%m/%d/%Y %I:%M %p') if user['last_login_at'] else 'Never' }}</td>
          <td>
            <div class="d-flex justify-content-center align-items-center gap-1">
              <button class="btn btn-info btn-sm view-user" 
                  data-user-id="{{ user['id'] }}" title="View">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn btn-primary btn-sm edit-user" 
                  data-user-id="{{ user['id'] }}" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-{{ 'secondary' if user['is_active'] else 'success' }} btn-sm toggle-status" 
                  data-user-id="{{ user['id'] }}" 
                  data-status="{{ user['is_active'] }}"
                  title="{{ 'Deactivate' if user['is_active'] else 'Activate' }}">
                <i class="fas fa-{{ 'toggle-on' if user['is_active'] else 'toggle-off' }}"></i>
              </button>
              <button class="btn btn-danger btn-sm delete-user" data-user-id="{{ user['id'] }}" title="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
          <td class="d-none">{{ user['role']|lower }}</td>
          <td class="d-none">{{ 'active' if user['is_active'] else 'inactive' }}</td>
        </tr>
      {% endfor %}
    </tbody>
{% endblock %}