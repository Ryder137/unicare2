{% extends "base.html" %}

{% block title %}Appointments - Guidance Counselor Dashboard - UniCare{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
            <div class="position-sticky pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('guidance.dashboard') }}">
                            <i class="bi bi-speedometer2 me-2"></i>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('guidance.students') }}">
                            <i class="bi bi-people me-2"></i>
                            Students
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="{{ url_for('guidance.appointments') }}">
                            <i class="bi bi-calendar-check me-2"></i>
                            Appointments
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('guidance.assessments') }}">
                            <i class="bi bi-clipboard-data me-2"></i>
                            Assessments
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('guidance.resources') }}">
                            <i class="bi bi-collection me-2"></i>
                            Resources
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('guidance.profile') }}">
                            <i class="bi bi-person me-2"></i>
                            Profile
                        </a>
                    </li>
                </ul>
                
                <hr>
                
                <div class="dropdown px-3">
                    <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="{{ current_user.avatar_url or url_for('static', filename='img/default-avatar.png') }}" alt="" width="32" height="32" class="rounded-circle me-2">
                        <strong>{{ current_user.first_name }} {{ current_user.last_name }}</strong>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark text-small shadow" aria-labelledby="userDropdown">
                        <li><a class="dropdown-item" href="{{ url_for('guidance.profile') }}">Profile</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('guidance.settings') }}">Settings</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ url_for('logout') }}">Sign out</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Main content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Appointment Management</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <button type="button" class="btn btn-sm btn-outline-secondary">
                            <i class="bi bi-calendar-week"></i> Week
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-secondary active">
                            <i class="bi bi-calendar-day"></i> Day
                        </button>
                        <button type="button" class="btn btn-sm btn-outline-secondary">
                            <i class="bi bi-calendar-month"></i> Month
                        </button>
                    </div>
                    <button type="button" class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#newAppointmentModal">
                        <i class="bi bi-plus-circle"></i> New Appointment
                    </button>
                </div>
            </div>

            <div class="row">
                <!-- Calendar View -->
                <div class="col-md-4">
                    <div class="card mb-4">
                        <div class="card-body">
                            <div id="appointmentCalendar"></div>
                        </div>
                    </div>
                    
                    <!-- Today's Appointments -->
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Today's Appointments</h5>
                        </div>
                        <div class="list-group list-group-flush">
                            <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">John Smith</h6>
                                    <small class="text-muted">9:00 AM - 9:45 AM</small>
                                </div>
                                <p class="mb-1">Academic Advising</p>
                                <small class="text-muted">Room 205</small>
                            </div>
                            <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Sarah Johnson</h6>
                                    <small class="text-muted">11:00 AM - 12:00 PM</small>
                                </div>
                                <p class="mb-1">Career Counseling</p>
                                <small class="text-muted">Guidance Office</small>
                            </div>
                            <div class="list-group-item">
                                <div class="d-flex w-100 justify-content-between">
                                    <h6 class="mb-1">Michael Brown</h6>
                                    <small class="text-muted">2:30 PM - 3:15 PM</small>
                                </div>
                                <p class="mb-1">Personal Counseling</p>
                                <small class="text-muted">Conference Room B</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Appointment List -->
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-body">
                            <ul class="nav nav-tabs mb-4" id="appointmentTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="upcoming-tab" data-bs-toggle="tab" data-bs-target="#upcoming" type="button" role="tab" aria-controls="upcoming" aria-selected="true">
                                        Upcoming <span class="badge bg-primary rounded-pill">5</span>
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab" aria-controls="pending" aria-selected="false">
                                        Pending <span class="badge bg-warning rounded-pill">3</span>
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed" type="button" role="tab" aria-controls="completed" aria-selected="false">
                                        Completed
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="cancelled-tab" data-bs-toggle="tab" data-bs-target="#cancelled" type="button" role="tab" aria-controls="cancelled" aria-selected="false">
                                        Cancelled
                                    </button>
                                </li>
                            </ul>
                            
                            <div class="tab-content" id="appointmentTabsContent">
                                <!-- Upcoming Appointments -->
                                <div class="tab-pane fade show active" id="upcoming" role="tabpanel" aria-labelledby="upcoming-tab">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Date & Time</th>
                                                    <th>Student</th>
                                                    <th>Type</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Today, 9:00 AM</td>
                                                    <td>John Smith</td>
                                                    <td>Academic Advising</td>
                                                    <td><span class="badge bg-success">Confirmed</span></td>
                                                    <td>
                                                        <div class="btn-group btn-group-sm">
                                                            <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#viewAppointmentModal">
                                                                <i class="bi bi-eye"></i>
                                                            </button>
                                                            <button class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#rescheduleAppointmentModal">
                                                                <i class="bi bi-calendar-week"></i>
                                                            </button>
                                                            <button class="btn btn-outline-danger">
                                                                <i class="bi bi-x-circle"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                                <!-- More appointment rows would go here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <!-- Other tab panes would go here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- New Appointment Modal -->
<div class="modal fade" id="newAppointmentModal" tabindex="-1" aria-labelledby="newAppointmentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="newAppointmentModalLabel">Schedule New Appointment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="appointmentForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="studentSelect" class="form-label">Student</label>
                                <select class="form-select" id="studentSelect" required>
                                    <option value="">Select Student</option>
                                    <option value="1">John Smith</option>
                                    <option value="2">Sarah Johnson</option>
                                    <option value="3">Michael Brown</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="appointmentType" class="form-label">Appointment Type</label>
                                <select class="form-select" id="appointmentType" required>
                                    <option value="">Select Type</option>
                                    <option value="academic">Academic Advising</option>
                                    <option value="career">Career Counseling</option>
                                    <option value="personal">Personal Counseling</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="appointmentDate" class="form-label">Date</label>
                                <input type="date" class="form-control" id="appointmentDate" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="startTime" class="form-label">Start Time</label>
                                <input type="time" class="form-control" id="startTime" required>
                            </div>
                            <div class="mb-3">
                                <label for="endTime" class="form-label">End Time</label>
                                <input type="time" class="form-control" id="endTime" required>
                            </div>
                            <div class="mb-3">
                                <label for="location" class="form-label">Location</label>
                                <input type="text" class="form-control" id="location" value="Guidance Office">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="notes" class="form-label">Notes</label>
                        <textarea class="form-control" id="notes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="appointmentForm" class="btn btn-primary">Schedule Appointment</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}
<!-- FullCalendar CSS -->
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css' rel='stylesheet' />
<!-- FullCalendar JS -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js'></script>

<script>
// Initialize tooltips
var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
});

// Initialize Calendar
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('appointmentCalendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        events: [
            {
                title: 'John Smith - Academic Advising',
                start: new Date().setHours(9, 0, 0, 0),
                end: new Date().setHours(9, 45, 0, 0),
                backgroundColor: '#0d6efd',
                borderColor: '#0d6efd'
            },
            // Add more events here
        ],
        dateClick: function(info) {
            // Handle date click (e.g., open new appointment modal)
            $('#appointmentDate').val(info.dateStr);
            $('#newAppointmentModal').modal('show');
        },
        eventClick: function(info) {
            // Handle event click (e.g., view appointment details)
            $('#viewAppointmentModal').modal('show');
            info.jsEvent.preventDefault();
        }
    });
    calendar.render();
});
</script>
{% endblock %}
