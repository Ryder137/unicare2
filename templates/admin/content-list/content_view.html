{% extends "admin/base.html" %}

{% block title %}View Content - UNICARE Back Office{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="h3 mb-0 text-gray-800">
            <i class="fas fa-eye me-2"></i>View Content
        </h1>
        <div class="d-flex gap-2">
            <a href="{{ url_for('content.edit_content', content_id=content.id) }}" class="btn btn-primary">
                <i class="fas fa-edit me-1"></i>Edit Content
            </a>
            <a href="{{ url_for('content.management') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i>Back to List
            </a>
        </div>
    </div>

    <!-- Content Details Card -->
    <div class="card shadow">
        <div class="card-header py-3 d-flex justify-content-between align-items-center">
            <h6 class="m-0 font-weight-bold text-primary">Content Details</h6>
            <span class="badge bg-{{ 'success' if content.is_active else 'secondary' }} fs-6">
                {{ 'Active' if content.is_active else 'Inactive' }}
            </span>
        </div>
        <div class="card-body">
            <div class="row">
                <!-- Basic Information -->
                <div class="col-md-6 mb-4">
                    <h6 class="text-primary mb-3">Basic Information</h6>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Author:</label>
                        <p class="ms-3">{{ content.author }}</p>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Content Type:</label>
                        <p class="ms-3">
                            {% set content_types = {
                                'general': 'General',
                                'mental_health': 'Mental Health',
                                'educational': 'Educational',
                                'motivational': 'Motivational',
                                'awareness': 'Awareness',
                                'announcement': 'Announcement'
                            } %}
                            <span class="badge bg-info">
                                {{ content_types.get(content.content_type, content.content_type or 'General') }}
                            </span>
                        </p>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Category:</label>
                        <p class="ms-3">
                            {% if content.category %}
                                {% set categories = {
                                    'student_support': 'Student Support',
                                    'wellness': 'Wellness',
                                    'academic': 'Academic',
                                    'social': 'Social',
                                    'career': 'Career',
                                    'health': 'Health',
                                    'emergency': 'Emergency'
                                } %}
                                <span class="badge bg-secondary">
                                    {{ categories.get(content.category, content.category) }}
                                </span>
                            {% else %}
                                <span class="text-muted">No category assigned</span>
                            {% endif %}
                        </p>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Target Audience:</label>
                        <p class="ms-3">
                            {% if content.target_audience %}
                                {% set audiences = {
                                    'all_students': 'All Students',
                                    'freshmen': 'Freshmen',
                                    'sophomores': 'Sophomores',
                                    'juniors': 'Juniors',
                                    'seniors': 'Seniors',
                                    'graduate_students': 'Graduate Students',
                                    'staff': 'Staff',
                                    'faculty': 'Faculty'
                                } %}
                                {{ audiences.get(content.target_audience, content.target_audience) }}
                            {% else %}
                                <span class="text-muted">No specific audience</span>
                            {% endif %}
                        </p>
                    </div>
                </div>
                
                <!-- Meta Information -->
                <div class="col-md-6 mb-4">
                    <h6 class="text-primary mb-3">Meta Information</h6>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Status:</label>
                        <p class="ms-3">
                            <span class="badge bg-{{ 'success' if content.is_active else 'secondary' }}">
                                {{ 'Active' if content.is_active else 'Inactive' }}
                            </span>
                        </p>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Created Date:</label>
                        <p class="ms-3">{{ content.created_at.strftime('%B %d, %Y at %I:%M %p') if content.created_at else 'N/A' }}</p>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Last Updated:</label>
                        <p class="ms-3">{{ content.updated_at.strftime('%B %d, %Y at %I:%M %p') if content.updated_at else 'N/A' }}</p>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Created By:</label>
                        <p class="ms-3">{{ content.created_by or 'N/A' }}</p>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Updated By:</label>
                        <p class="ms-3">{{ content.updated_by or 'N/A' }}</p>
                    </div>
                </div>
            </div>
            
            <!-- Content Message -->
            <div class="row">
                <div class="col-12 mb-4">
                    <h6 class="text-primary mb-3">Content Message</h6>
                    <div class="border rounded p-4 bg-light">
                        <div class="content-message">
                            {{ content.messages|safe if content.messages else '<span class="text-muted">No message content</span>' }}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tags -->
            <div class="row">
                <div class="col-12 mb-4">
                    <h6 class="text-primary mb-3">Tags</h6>
                    {% if content.tags %}
                        <div class="tags-container">
                            {% for tag in content.tags.split(',') %}
                                <span class="badge bg-light text-dark me-2 mb-2">{{ tag.strip() }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-muted">No tags assigned</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="row">
                <div class="col-12">
                    <div class="d-flex gap-2">
                        <a href="{{ url_for('content.edit_content', content_id=content.id) }}" class="btn btn-primary">
                            <i class="fas fa-edit me-1"></i>Edit Content
                        </a>
                        <button class="btn btn-{{ 'secondary' if content.is_active else 'success' }}" onclick="toggleStatus('{{ content.id }}')">
                            <i class="fas fa-{{ 'toggle-on' if content.is_active else 'toggle-off' }} me-1"></i>
                            {{ 'Deactivate' if content.is_active else 'Activate' }}
                        </button>
                        <button class="btn btn-danger" onclick="deleteContent('{{ content.id }}')">
                            <i class="fas fa-trash me-1"></i>Delete
                        </button>
                        <a href="{{ url_for('content.management') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-1"></i>Back to List
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">
                    <i class="fas fa-exclamation-triangle me-2 text-danger"></i>Confirm Delete
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to permanently delete this content?</p>
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Warning:</strong> This action cannot be undone.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="confirmDelete()">
                    <i class="fas fa-trash me-1"></i>Delete Permanently
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let contentToDelete = null;

function toggleStatus(contentId) {
    $.ajax({
        url: `/content/toggle-status/${contentId}`,
        method: 'POST',
        success: function(response) {
            if (response.success) {
                showAlert('success', response.message);
                // Reload page after a delay
                setTimeout(() => {
                    location.reload();
                }, 1000);
            } else {
                showAlert('error', response.error || 'Failed to update status');
            }
        },
        error: function(xhr) {
            showAlert('error', xhr.responseJSON?.error || 'Failed to update status');
        }
    });
}

function deleteContent(contentId) {
    contentToDelete = contentId;
    $('#deleteModal').modal('show');
}

function confirmDelete() {
    if (contentToDelete) {
        $.ajax({
            url: `/content/delete/${contentToDelete}`,
            method: 'DELETE',
            success: function(response) {
                if (response.success) {
                    showAlert('success', 'Content deleted successfully!');
                    $('#deleteModal').modal('hide');
                    // Redirect to content list after a delay
                    setTimeout(() => {
                        window.location.href = '{{ url_for("content.management") }}';
                    }, 1500);
                } else {
                    showAlert('error', response.error || 'Failed to delete content');
                }
            },
            error: function(xhr) {
                showAlert('error', xhr.responseJSON?.error || 'Failed to delete content');
            }
        });
    }
}

function showAlert(type, message) {
    const alertClass = type === 'error' ? 'alert-danger' : 
                      type === 'warning' ? 'alert-warning' : 'alert-success';
    
    const alert = $(`
        <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    `);
    
    $('.container-fluid').prepend(alert);
    
    setTimeout(() => {
        alert.fadeOut();
    }, 5000);
}
</script>
{% endblock %}