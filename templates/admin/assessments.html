{% extends "admin/new_base.html" %}

{% block title %}Manage Assessments - Admin Panel{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <h1 class="mt-4">Manage Assessments</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a href="{{ url_for('admin.dashboard') }}">Dashboard</a></li>
        <li class="breadcrumb-item active">Assessments</li>
    </ol>

    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-clipboard-list me-1"></i>
            Assessment List
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="assessmentsTable" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>User</th>
                            <th>Type</th>
                            <th>Status</th>
                            <th>Date Taken</th>
                            <th>Score</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Assessment data will be loaded here via JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    // Initialize DataTable
    var table = $('#assessmentsTable').DataTable({
        processing: true,
        serverSide: true,
        ajax: {
            url: '{{ url_for("admin.get_assessments") }}',
            type: 'GET'
        },
        columns: [
            { data: 'id' },
            { data: 'user_name' },
            { data: 'assessment_type' },
            { 
                data: 'status',
                render: function(data, type, row) {
                    let statusClass = 'secondary';
                    if (data === 'Completed') statusClass = 'success';
                    else if (data === 'In Progress') statusClass = 'warning';
                    else if (data === 'Pending') statusClass = 'info';
                    
                    return `<span class="badge bg-${statusClass}">${data}</span>`;
                }
            },
            { data: 'date_taken' },
            { data: 'score' },
            {
                data: null,
                orderable: false,
                render: function(data, type, row) {
                    return `
                        <div class="btn-group" role="group">
                            <a href="${row.view_url}" class="btn btn-sm btn-primary" title="View">
                                <i class="bi bi-eye"></i>
                            </a>
                            <button class="btn btn-sm btn-warning" title="Edit" onclick="editAssessment(${row.id})">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" title="Delete" onclick="confirmDelete(${row.id})">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>`;
                }
            }
        ]
    });
});

function editAssessment(id) {
    // TODO: Implement edit functionality
    alert('Edit assessment ' + id);
}

function confirmDelete(id) {
    if (confirm('Are you sure you want to delete this assessment?')) {
        // TODO: Implement delete functionality
        alert('Delete assessment ' + id);
    }
}
</script>
{% endblock %}
